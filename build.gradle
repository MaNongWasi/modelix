import java.text.SimpleDateFormat

buildscript {
    ext.kotlinVersion = '1.4.31'

    repositories {
        /* It is useful to have the central maven repo before the Itemis's one
           as it is more reliable */
        maven { url "https://repo.maven.apache.org/maven2" }
        maven { url 'https://projects.itemis.de/nexus/content/repositories/mbeddr' }        
        maven { url 'https://plugins.gradle.org/m2/' }
        mavenCentral()
    }

    dependencies {
        classpath 'de.itemis.mps:mps-gradle-plugin:1.2.168.+'
        classpath 'com.google.googlejavaformat:google-java-format:1.8+'
    }
}

plugins {
    id "org.jetbrains.kotlin.multiplatform" version "${kotlinVersion}" apply false
    id "org.jlleitschuh.gradle.ktlint" version "9.3.0" apply false
    id "com.diffplug.gradle.spotless" version "4.5.1" apply false
    id "com.jfrog.bintray" version "1.8.5" apply false
}

def mpsVersionProps = new Properties()
file("mps-version.properties").withInputStream { mpsVersionProps.load(it) }
ext.mpsMajorVersion = mpsVersionProps.getProperty("mpsMajorVersion")
ext.mpsMinorVersion = mpsVersionProps.getProperty("mpsMinorVersion")
ext.mpsVersion = mpsVersionProps.getProperty("mpsVersion")

if (System.getenv("TRAVIS_TAG") != null && !System.getenv("TRAVIS_TAG").isEmpty()) {
    ext.modelixVersion = System.getenv("TRAVIS_TAG")
} else {
    def versionFile = new File("$rootDir/modelix.version")
    if (versionFile.exists()) {
        ext.modelixVersion = versionFile.text.trim()
    } else {
        ext.modelixVersion = "$mpsVersion-SNAPSHOT-" + new SimpleDateFormat("yyyyMMddHHmm").format(new Date())
        versionFile.write(ext.modelixVersion)
    }
}

allprojects {
    group 'org.modelix'
    version modelixVersion

    repositories {
        /* It is useful to have the central maven repo before the Itemis's one
           as it is more reliable */
        maven { url "https://repo.maven.apache.org/maven2" }
        mavenCentral()
        mavenLocal()
        maven { url 'https://projects.itemis.de/nexus/content/groups/OS/' }                
    }
}
description = "Cloud storage and web UI for MPS"

defaultTasks 'assemble'
